#!/bin/sh

# Wait for the last command sent to background to create a window
wait_for_program () {
	local c=0; until [ $((++c)) -eq 15 ]; do
		xdotool search --onlyvisible --pid $! 2>/dev/null && break
		sleep 1
    done
	[ $c -eq 15 ] && i3-nagbar -m "Error on executing $0 script"
}

# Terminal
TERMINAL=urxvt256c-ml

## Determine connected monitors
HDMI_YES=0
DP_YES=0
ANY_YES=0
xrandr | grep -Eq "DP[12345]-[12345] connected" && DP_YES=1 && ANY_YES=1
xrandr | grep -Eq "HDMI[12345] connected" && HDMI_YES=1 && ANY_YES=1
DP=$(xrandr | grep -E "DP[12345]-[12345] connected" | grep -oE "DP[12345]-[12345]")
HDMI=$(xrandr | grep -E "HDMI[12345] connected" | grep -oE "HDMI[12345]")

#pointer_control disable

if [ "$HDMI_YES" -eq 1 ] && [ "$DP_YES" -eq 1 ]; then
    sh $HOME/.screenlayout/home.sh
else
    sh $HOME/.screenlayout/laptop.sh
fi

i3-msg workspace 1
$TERMINAL &
wait_for_program
sleep 5

i3-msg workspace 3
$TERMINAL --title "Ranger" -e zsh -c "/usr/bin/ranger $HOME/" &
wait_for_program

#i3-msg workspace 4
#$TERMINAL --title "DEVEL" -e zsh -c "/usr/bin/mux DEVEL" &
#wait_for_program

#i3-msg workspace 5
#$TERMINAL --title "REDHAT" -e zsh -c "/usr/bin/mux RedHat" &
#wait_for_program

#if [ "$DP_YES" -eq 1 ]; then
    #i3-msg workspace 7
    #$TERMINAL --title "IRC" -e zsh
    #wait_for_program
#else
    #i3-msg workspace 6
    #$TERMINAL --title "IRC" -e zsh
    #wait_for_program
#fi

#pointer_control enable
xrefresh &

# Update dmenu cache
dmenu_path >/dev/null &

exit 0
