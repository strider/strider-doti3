#!/bin/sh

# Wait for program coming up
wait_for_program () {
  n=0
  while true
  do
    # PID of last background command
    if xdotool search --onlyvisible --pid $! 2>/dev/null; then
      break
    else
      if [ $n -eq 90 ]; then
        notify-send -u critical "Error during start"
        break
      else
        n=`expr $n + 1`
        sleep 0.1
      fi
    fi
  done
}

# Background
[ -e ~/.fehbg ] && eval `cat ~/.fehbg`

# Terminal
TERMINAL=urxvt256c-ml

EXT_SCREEN='None'
EXT_SCREEN=`xrandr | grep -q " connected" | awk '{print $1}' | grep -v "HDMI1"`

## Workspace 1-4
for w in 1 4; do
    i3-msg workspace $w
    $TERMINAL &
    wait_for_program
done

i3-msg workspace 3
$TERMINAL -e zsh -c "~/.local/bin/ranger ~/" &
wait_for_program

i3-msg workspace 2
#firefox &

if [ $EXT_SCREEN != 'None' ]; then
  for w in 1 2 3 4 5 6 7 8; do
    i3-msg "move workspace ${w}; to output ${EXT_SCREEN}"
  done
fi

## Refresh and GO!
xrefresh &

exit 0
