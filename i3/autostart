#!/bin/sh

# Wait for program coming up
wait_for_program () {
  n=0
  while true
  do
    # PID of last background command
    if xdotool search --onlyvisible --pid $! 2>/dev/null; then
      break
    else
      if [ $n -eq 90 ]; then
        notify-send -u critical "Error during start"
        break
      else
        n=`expr $n + 1`
        sleep 0.5
      fi
    fi
  done
}

## Merge Xressources
xrdb -merge ~/.Xresources &

#xsetroot -solid '#000000' &
exec feh --bg-scale ~/Pictures/IMG_5269.JPG &

## Set startup volume
pactl set-sink-volume 0 '30%' &

## Disable beeps
xset -b &

## Keybord layout setting
setxkbmap -layout uk -option grp:shift_shift_toggle &

## Set LCD brightness
xbacklight -set 100 &

## Clipboard manager
LC_ALL=C parcellite &

## OSD
dunst &

## Mail checker
dunst-checkmail -p ~/Maildir/INBOX/cur/ -s 150 &

## Load "funny" sample
pactl upload-sample ~/.i3/that_was_easy.wav that_was_easy &

## Set touchpad off
synclient TouchpadOff=1

PANEL_CONNECTED=0; xrandr | grep -qE "(LVDS1|VGA1) connected" && PANEL_CONNECTED=1

if [ grep -qE "VGA1 connected" ]; then
  # my configuration is for DP1 (move workspaces explicitly)
  i3-msg move workspace 1 to output VGA1
  i3-msg move workspace 2 to output VGA1
  i3-msg move workspace 3 to output VGA1
  i3-msg move workspace 4 to output VGA1
fi

## Working shells on workspace 1
i3-msg workspace 1
i3-msg layout tabbed
urxvt256c-ml -name "TMUX Session" -e bash -c "tmux -q has-session && exec tmux attach-session -d || exec tmux new-session -sStrider" &
wait_for_program

## Refresh and GO!
xrefresh &

#exec /usr/libexec/gnome-settings-daemon &
exec /usr/libexec/gnome-session/helpers/gnome-settings-daemon-helper &
exec /usr/libexec/polkit-gnome-authentication-agent-1 &
exec /usr/bin/gnome-keyring-daemon --start --components=gpg &
exec /usr/bin/gnome-keyring-daemon --start --components=ssh &
exec /usr/bin/gnome-keyring-daemon --start --components=secrets &
LC_ALL=C nm-applet &
exec ssh-add &
