#!/bin/sh

# Wait for program coming up
wait_for_program () {
  n=0
  while true
  do
    # PID of last background command
    if xdotool search --onlyvisible --pid $! 2>/dev/null; then
      break
    else
      if [ $n -eq 90 ]; then
        notify-send -u critical "Error during start"
        break
      else
        n=`expr $n + 1`
        sleep 0.1
      fi
    fi
  done
}

# Terminal
TERMINAL=urxvt256c-ml

## Determine connected monitors
HDMI_YES=0
DP_YES=0
ANY_YES=0
xrandr | grep -Eq "DP[12345]-[12345] connected" && DP_YES=1 && ANY_YES=1
xrandr | grep -Eq "HDMI[12345] connected" && HDMI_YES=1 && ANY_YES=1
DP=$(xrandr | grep -E "DP[12345]-[12345] connected" | grep -oE "DP[12345]-[12345]")
HDMI=$(xrandr | grep -E "HDMI[12345] connected" | grep -oE "HDMI[12345]")

## Workspace 1-4
for w in 1 4; do
    i3-msg workspace $w
    $TERMINAL &
    wait_for_program
done

i3-msg workspace 3
$TERMINAL -e zsh -c "~/.local/bin/ranger ~/" &
wait_for_program

i3-msg workspace 2
##firefox &

if [ $EXT_SCREEN != 'None' ]; then
  for w in 1 2 3 4 5 6 7 8; do
    i3-msg "move workspace ${w}; to output ${EXT_SCREEN}"
  done
fi

## Refresh and GO!
xrefresh &

exit 0
